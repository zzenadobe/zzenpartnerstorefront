/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as s,jsxs as l,Fragment as $}from"@dropins/tools/preact-jsx-runtime.js";import{classes as k,Slot as U}from"@dropins/tools/lib.js";import{S as K,c as Q,E as X,C as Z}from"../chunks/CustomerInformationCard.js";import"@dropins/tools/preact-compat.js";import{Card as R,Icon as V,Price as rr,ContentGrid as tr,Image as W,Header as sr,Picker as er,Pagination as ar}from"@dropins/tools/components.js";import{useText as D}from"@dropins/tools/i18n.js";import{useState as y,useEffect as Y,useMemo as cr,useCallback as j}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import{g as nr}from"../chunks/getOrderHistoryList.js";import{g as or}from"../chunks/getStoreConfig.js";import"../chunks/removeCustomerAddress.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";import"../fragments.js";const m={size:"32",stroke:"2"},G=({minifiedView:a,orderNumber:c,orderToken:r,routeOrdersList:e,routeOrderDetails:u})=>{const n=a?"minifiedView":"fullSizeView",i=D({viewAllOrdersButton:`Account.${n}.OrdersList.viewAllOrdersButton`,ariaLabelLink:`Account.${n}.OrdersList.ariaLabelLink`});return e?s("a",{className:k(["account-orders-list-action",["account-orders-list-action--minifiedView",a]]),"data-testid":"ordersListActionButtonMinifiedView",href:e(),children:s(R,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:l("div",{className:"account-orders-list-action__card-wrapper",children:[s("p",{children:i.viewAllOrdersButton}),s(V,{source:K,...m})]})})}):s("a",{"aria-label":`${i.ariaLabelLink} ${c??r}`,href:Q(u)?u(c,r):"#",className:"account-orders-list-action","data-testid":"ordersListActionButton",children:s(V,{source:K,...m})})},dr=()=>{const[a,c]=y(window.innerWidth<768);return Y(()=>{const r=()=>{c(window.innerWidth<768)};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),a},ir=({placeholderImage:a,minifiedView:c,item:r,withThumbnails:e,children:u,slots:n,routeTracking:i,routeOrderProduct:p,routeReturnDetails:f,...b})=>{var g,I,_,x,N,M,P,O,z,w,T,v;const o=c?"minifiedView":"fullSizeView",h=D({orderNumber:`Account.${o}.OrdersList.OrdersListCard.orderNumber`,itemsAmount:`Account.${o}.OrdersList.OrdersListCard.itemsAmount`,carrier:`Account.${o}.OrdersList.OrdersListCard.carrier`,returnsText:`Account.${o}.OrdersList.OrdersListCard.returns`,deliveryDateText:`Account.${o}.OrdersList.OrdersListCard.orderDate`}),d=dr(),S=Q(p);return l(R,{variant:"secondary",...b,className:k(["account-orders-list-card",["account-orders-list-card--full",((g=r==null?void 0:r.items)==null?void 0:g.length)>6]]),children:[s("div",{className:"account-orders-list-card__content",children:n!=null&&n.OrdersListCard?s(U,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:n==null?void 0:n.OrdersListCard,context:{orderHistoryListItem:r}}):l($,{children:[s("div",{children:r==null?void 0:r.status}),l("p",{children:[h.deliveryDateText," ",r==null?void 0:r.orderDate]}),l("p",{children:[h.orderNumber," ",r.number]}),(I=r==null?void 0:r.shipments)==null?void 0:I.map(t=>{var L;return(L=t==null?void 0:t.tracking)==null?void 0:L.map(A=>{const C=i==null?void 0:i(A);return l("p",{"data-testid":A.number,children:[s("span",{children:`${h.carrier} ${A.carrier.toLocaleUpperCase()} `}),C?s("a",{href:C,target:"_blank",className:"account-orders-list-card__content--track_number",rel:"noreferrer",children:A.number}):s("span",{className:"account-orders-list-card__content--track_number",children:A.number})]},t.id)})}),r!=null&&r.returns&&((_=r.returns)!=null&&_.length)?l("p",{"data-testid":r.number,children:[l("span",{children:[h.returnsText," "]}),(x=r==null?void 0:r.returns)==null?void 0:x.map(t=>s("span",{"data-testid":t.number,children:l("a",{href:(f==null?void 0:f({orderNumber:r.number,orderToken:r.token,returnNumber:t.number}))??"#",className:"account-orders-list-card__content--return_number",children:[t.number," "]})},t.uid))]},r.id):null,s("p",{children:s(rr,{amount:((M=(N=r==null?void 0:r.total)==null?void 0:N.grandTotal)==null?void 0:M.value)??0,currency:(O=(P=r==null?void 0:r.total)==null?void 0:P.grandTotal)==null?void 0:O.currency,weight:"normal",size:"medium"})}),l("p",{"data-testid":"itemsAmount",children:[(z=r==null?void 0:r.items)!=null&&z.length?(w=r==null?void 0:r.items)==null?void 0:w.reduce((t,L)=>{const A=(L==null?void 0:L.quantityOrdered)||0;return t+A},0):0," ",h.itemsAmount]}),(T=r==null?void 0:r.items)==null?void 0:T.map((t,L)=>{if(L>=0&&L<10)return l("p",{className:"account-orders-list-card__content--product-name",children:[l("span",{className:"account-orders-list-card__content--quantity",children:[(t==null?void 0:t.quantityOrdered)>1?t==null?void 0:t.quantityOrdered:null," "]}),t==null?void 0:t.productName.replaceAll("-"," ")]},`${L}_${t.id}`);if(L===11)return s("p",{children:"..."},"ellipsis")})]})}),e&&((v=r==null?void 0:r.items)!=null&&v.length)?s(tr,{maxColumns:d?3:9,emptyGridContent:s($,{}),className:k(["account-orders-list-card__images",["account-orders-list-card__images-3",d]]),"data-testid":"ordersListCardImages",children:r.items.map((t,L)=>{var H,q,B,F,J;const A=(B=(q=(H=t==null?void 0:t.product)==null?void 0:H.smallImage)==null?void 0:q.url)!=null&&B.length?(J=(F=t==null?void 0:t.product)==null?void 0:F.smallImage)==null?void 0:J.url:a,C=(t==null?void 0:t.productName)??"";return S?s("a",{href:(p==null?void 0:p(t))??"",target:"_blank",rel:"noreferrer",children:s(W,{src:A,width:65,height:65,alt:C})},t.id+L):s(W,{src:A,width:65,height:65,alt:C},t.id+L)})}):null,s("div",{className:"account-orders-list-card__actions",children:u})]})},lr=({ordersInMinifiedView:a,minifiedView:c,pageSize:r,selectedDate:e,selectedPage:u,handleSetFirstOrderDate:n})=>{const[i,p]=y([]),[f,b]=y({totalPages:1,currentPage:1,pageSize:1}),[o,h]=y(!1),[d,S]=y("");return Y(()=>{or().then(g=>{S(g.baseMediaUrl)})},[]),Y(()=>{h(!0),nr(c?a:r,e,u).then(g=>{!g||!g.items||(b(g.pageInfo),p(g.items),n==null||n(g.dateOfFirstOrder))}).finally(()=>{h(!1)})},[n,c,a,r,e,u]),{loading:o,orderHistoryListItems:i,pageInfo:f,placeholderImage:d}},E=(a,c=1)=>{const r=new Date,e=new Date(r);switch(a){case"sixMonthsAgo":{e.setMonth(e.getMonth()-c);break}case"oneYearAgo":{e.setFullYear(e.getFullYear()-c);break}default:return""}return{from:e==null?void 0:e.toISOString().split("T")[0],to:`${r==null?void 0:r.toISOString().split("T")[0]} 23:59:59`}},ur=a=>{const c=[],r=new Date().getFullYear();for(let e=a;e<=r-1;e++)c.push({value:`{"from":"${e}-01-01","to":"${e+1}-01-01 23:59:59"}`,text:e.toString()});return c},hr=()=>{const a=D({pastSixMonths:"Account.fullSizeView.OrdersList.OrdersListSelectDate.pastSixMonths",currentYear:"Account.fullSizeView.OrdersList.OrdersListSelectDate.currentYear",viewAll:"Account.fullSizeView.OrdersList.OrdersListSelectDate.viewAll"}),[c,r]=y(),[e,u]=y(JSON.stringify(E("sixMonthsAgo",6))),[n,i]=y(1);Y(()=>{window==null||window.scrollTo({top:100,behavior:"smooth"})},[n]);const p=cr(()=>{const o=[{value:JSON.stringify(E("sixMonthsAgo",6)),text:a.pastSixMonths},{value:JSON.stringify(E("oneYearAgo",1)),text:a.currentYear},{value:"viewAll",text:a.viewAll}];if(c){const d=new Date(c).getFullYear();o==null||o.splice(2,0,...ur(d))}return o},[a,c]),f=j(o=>{r(o)},[]),b=j(o=>{const d=o.target.value;u(d),i(1)},[]);return{selectableDateList:p,selectedDate:e,selectedPage:n,handleSelectDate:b,setSelectedPage:i,handleSetFirstOrderDate:f}},gr=({className:a,withHeader:c=!0,minifiedView:r=!1,withThumbnails:e=!0,withFilter:u=!0,ordersInMinifiedView:n=1,pageSize:i=10,routeOrdersList:p,routeOrderDetails:f,routeReturnDetails:b,routeTracking:o,routeOrderProduct:h,slots:d})=>{const S=r?"minifiedView":"fullSizeView",g=D({containerTitle:`Account.${S}.OrdersList.containerTitle`,dateOrderPlaced:`Account.${S}.OrdersList.dateOrderPlaced`}),{selectableDateList:I,selectedDate:_,handleSelectDate:x,selectedPage:N,setSelectedPage:M,handleSetFirstOrderDate:P}=hr(),{pageInfo:O,loading:z,orderHistoryListItems:w,placeholderImage:T}=lr({minifiedView:r,pageSize:i,ordersInMinifiedView:n,selectedDate:_,selectedPage:N,handleSetFirstOrderDate:P});return l("div",{children:[c?s(sr,{"aria-label":g.containerTitle,role:"region",title:g.containerTitle,divider:!r,className:r?"account-orders-list-header":""}):null,l("div",{className:k(["account-orders-list",a]),children:[!r&&u?l("div",{className:"account-orders-list__date-select",children:[s("span",{children:g.dateOrderPlaced}),s(er,{value:_,name:"orderDatePicker",options:I,handleSelect:x})]}):null,z?s($,{children:Array.from(Array(O==null?void 0:O.pageSize).keys()).map(v=>s(Z,{testId:"orderSkeletonLoader",withCard:!1},v))}):s($,{children:w.length?s($,{children:w.map((v,t)=>s(ir,{placeholderImage:T,routeTracking:o,routeOrderProduct:h,routeReturnDetails:b,minifiedView:r,item:v,withThumbnails:e,slots:d,children:d!=null&&d.OrdersListAction?s(U,{"data-testid":`ordersListActionSlot_${t}`,name:"OrdersListAction",slot:d==null?void 0:d.OrdersListAction,context:{orderHistoryListItem:v}}):s(G,{minifiedView:r,orderNumber:v.number,orderToken:v.token,routeOrderDetails:f})},t))}):s(X,{isEmpty:!w.length,typeList:"orders",minifiedView:r})}),!r&&(O==null?void 0:O.totalPages)>1?s(ar,{totalPages:O==null?void 0:O.totalPages,currentPage:N,onChange:M}):null,r?s(G,{minifiedView:r,routeOrdersList:p}):null]})]})},kr=({className:a,withHeader:c,minifiedView:r,withThumbnails:e,withFilter:u,ordersInMinifiedView:n,pageSize:i,routeOrdersList:p,routeOrderDetails:f,routeReturnDetails:b,routeTracking:o,routeOrderProduct:h,slots:d})=>s("div",{className:k(["account-orders-list",a]),"data-testid":"ordersListId",children:s(gr,{className:a,withHeader:c,minifiedView:r,withThumbnails:e,withFilter:u,ordersInMinifiedView:n,pageSize:i,routeOrdersList:p,routeOrderDetails:f,routeReturnDetails:b,routeTracking:o,routeOrderProduct:h,slots:d})});export{kr as OrdersList,kr as default};
