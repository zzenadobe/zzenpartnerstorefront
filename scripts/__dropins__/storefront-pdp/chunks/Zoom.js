/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as F,jsx as C,Fragment as bt}from"@dropins/tools/preact-jsx-runtime.js";import*as ot from"@dropins/tools/preact-compat.js";import{useState as X,Children as j,useRef as K,useMemo as vt,useEffect as R,useCallback as rt}from"@dropins/tools/preact-compat.js";import{debounce as yt,classes as N}from"@dropins/tools/lib.js";import{Button as mt,Icon as Wt}from"@dropins/tools/components.js";/* empty css     */import{useText as A}from"@dropins/tools/i18n.js";import{cloneElement as Et}from"@dropins/tools/preact.js";const kt=c=>ot.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...c},ot.createElement("path",{d:"M7.74512 9.87701L12.0001 14.132L16.2551 9.87701",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),Ct=c=>ot.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...c},ot.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),ot.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),$t=24,wt=16,Xt="32";var Mt=(c=>(c[c.small=16]="small",c[c.medium=24]="medium",c[c.large=64]="large",c))(Mt||{});const Ht=({show:c=1,scrollbar:m=!1,peak:_=!1,arrows:i=!1,controls:n="dots",arrowsOnMainImage:$=!1,loop:l=!1,gap:b=null,direction:M="horizontal",width:W="100%",height:J="100%",defaultIndex:Y=0,className:ct,children:E,thumbnails:Q=null,isZoomed:P,...V})=>{const z=A("PDP.Carousel.label").label,at=A("PDP.Carousel.Slide.label").label,it=A("PDP.Carousel.Previous.label").label,B=A("PDP.Carousel.Next.label").label,ut=A("PDP.Carousel.Controls.label").label,nt=A("PDP.Carousel.Controls.Button.label").label,[h,ht]=X(()=>Lt(c)),g=Math.ceil(j.count(E)/h),L=_?$t:0,q=b?Mt[b]:0,H=j.count(E)%h,[u,ft]=X(l?k()?Y-1:Y+1:Y),e=K([]),[y,x]=X(0),[w,O]=X(0),I=vt(()=>j.toArray(Q),[Q]),f=vt(()=>{const t=j.toArray(E).reduce((r,s,o)=>o%h===0?[...r,[s]]:[...r.slice(0,-1),[...r[r.length-1],s]],[]);return!l||t.length===1?t:l&&j.count(E)%h===0?[t[g-1]].concat(t).concat([t[0],t[1]]):[j.toArray(E).slice(-h)].concat(t).concat([t[0],t[1]])},[E,h,g,l]),S=K(null),Z=K(null),d=n==="thumbnailsRow"||n==="thumbnailsColumn";R(()=>{const t=S.current;if(!t)return;const r=yt(()=>{x(t.offsetWidth??0),O(t.offsetHeight??0);const o=window.innerWidth,a=Lt(c,o);a!==h&&ht(a)},50),s=new ResizeObserver(r);return s.observe(t),()=>{s.unobserve(t)}},[h,c]);const G=rt(t=>{const r=l?t-1:t,s=e==null?void 0:e.current[0],o=(s==null?void 0:s.offsetWidth)+wt,a=(s==null?void 0:s.offsetHeight)+wt,p=Z.current,U=n==="thumbnailsRow",lt=n==="thumbnailsColumn",T=U?p==null?void 0:p.offsetWidth:p==null?void 0:p.offsetHeight,D=U?o:a;if((U||lt)&&T){const Nt=Math.floor((U?p.clientWidth:p.clientHeight)/D),Dt=Math.floor(Nt/2),pt=(r-Dt)*D;p.style.scrollBehavior="smooth",U?p.scrollLeft=k()?-(p.scrollWidth-p.clientWidth-pt):pt:p.scrollTop=pt}},[n,l]);R(()=>{G(u)},[u,G]);const v=rt((t,r,s)=>{d&&G(t);const o=S.current,a=L?o.offsetWidth-L:o.offsetWidth-L+q;if(!Array.from(o.querySelectorAll("[data-index]")).filter(T=>{const D=Number(T.getAttribute("data-index"));return!isNaN(D)&&D>-1})[t])return;if(s){const T=t===0?g:0,D=a*(g+(H||h)/h);if(k()){if(o.scrollLeft<=0&&o.scrollLeft>-(a-5)){v(1,!0);return}if(o.scrollLeft<a-D&&o.scrollLeft>=-D){v(g,!0);return}o.style.scrollBehavior="auto",o.scrollLeft=T===0?0:-D,v(T===0?1:g,!0)}else{if(o.scrollLeft>=0&&o.scrollLeft<a-5){v(1,!0);return}if(o.scrollLeft>D-a&&o.scrollLeft<=D){v(g,!0);return}o.style.scrollBehavior="auto",o.scrollLeft=T===0?0:D,v(T===0?1:g,!0);return}}const lt=(o.offsetWidth-q)/h*f[t].length-L;o.style.scrollBehavior=r?"smooth":"auto",o.scrollLeft=k()?-(f[t].length===h?a*t:a*(t-1)-lt):f[t].length===h?a*t:a*(t-1)+lt},[q,g,L,h,H,f,G,n]),tt=rt(()=>{if(l){const r=u-1;v(r,!0,k()?u===g-1:u===1);return}const t=u<=0?0:u-1;v(t,!0)},[u,v,l]),et=rt(()=>{const t=f.length-1;if(l){const s=u+1;v(s,!0,k()?u===0:u===g);return}const r=u>=t?t:u+1;v(r,!0)},[f.length,l,u,v,g]);R(()=>{const t=r=>{r.key==="ArrowLeft"&&(r.preventDefault(),k()?et():tt()),r.key==="ArrowRight"&&(r.preventDefault(),k()?tt():et())};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[et,tt]),R(()=>{v(l?Y+1:Y,!1)},[Y,v,l]);const dt=yt(()=>{const t=S.current,r=L?t.offsetWidth-L:t.offsetWidth-L+q,s=Math.abs(t.scrollLeft)/r,o=Math.abs(Math.round(s)-s<1?Math.round(s):Math.ceil(s));if(d&&G(o),l){const a=r*(g+(H||h)/h),p=k()?-t.scrollLeft:t.scrollLeft;if(Math.ceil(Math.abs(p))>=Math.ceil(a)-5){t.style.scrollBehavior="auto",t.scrollLeft=k()?-t.offsetWidth+(Math.ceil(p)-Math.ceil(a)-L):t.offsetWidth+(Math.ceil(p)-Math.ceil(a)-L);return}if(Math.abs(p)===0){t.style.scrollBehavior="auto",t.scrollLeft=k()?-(a-t.offsetWidth+L):a-t.offsetWidth+L;return}}u!==o&&ft(o)},100);R(()=>{const t=S.current;return t==null||t.addEventListener("scroll",dt),()=>{t==null||t.removeEventListener("scroll",dt)}},[dt]);const st=(t,r,s)=>C(mt,{className:N([["pdp-carousel__button",!t],[`pdp-carousel__button--${r}`,!t],[`pdp-carousel__button--${n}`,t]]),style:{"--height":`${w}px`},variant:"tertiary","aria-label":r==="next"?B:it,onClick:s,disabled:l?!1:r==="next"?u>=f.length-1:u<1,children:C(Wt,{className:N([["pdp-carousel__button__icon",!t],[`pdp-carousel__button__icon--${r}`,!t],[`pdp-carousel__button__icon--${n}--${r}`,t]]),size:Xt,source:kt})}),gt=i&&f.length!=1&&st(d,"prev",tt),_t=i&&f.length!=1&&st(d,"next",et),Pt=i&&f.length!=1&&st(!1,"prev",tt),xt=i&&f.length!=1&&st(!1,"next",et);return F("div",{role:"region","aria-roledescription":z,className:N(["pdp-carousel",["pdp-carousel--main-image-controls",$],["pdp-carousel--arrows",i&&!d],[`pdp-carousel--${n}`,d],ct]),style:{"--flex-carousel":n==="thumbnailsColumn"?"row-reverse":"column","--gap":d?"0":"var(--spacing-small)","--width":W},...V,children:[C("div",{ref:S,className:N(["pdp-carousel__wrapper",`pdp-carousel__wrapper--${M}`,["pdp-carousel__wrapper--scrollbar",m],["pdp-carousel__wrapper--peak",_]]),style:{"--total-width":n==="thumbnailsColumn"?"81.6%":"100%","--height":n==="thumbnailsColumn"?"auto":J,"--gap":b?`var(--spacing-${b})`:"0px","--per-page":h},tabIndex:0,children:f.map((t,r)=>{const s=t.length<h;return C("div",{role:"group","aria-roledescription":at,"data-index":r,className:N(["pdp-carousel__slide",`pdp-carousel__slide--${M}`,["pdp-carousel__slide--active",u===r],["pdp-carousel__slide--orphan",s]]),style:{"--length":t.length},children:t},r)})}),!d&&F(bt,{children:[gt,_t]}),d&&$&&F(bt,{children:[Pt,xt]}),n&&f.length!=1&&F("div",{className:N([[`pdp-carousel__controls__container--${n}`,d],["pdp-carousel__controls__container--no-arrows",!i||$]]),style:{"--width":n==="thumbnailsRow"?`${y}px`:W,"--height":`${w}px`,"--nr-thumbnails":I.length},children:[(d||P)&&!$&&gt,C("div",{ref:Z,className:N([[`pdp-carousel__controls__wrapper--${n}`,d],["pdp-carousel__controls__wrapper",d]]),children:C("div",{role:"group","aria-label":ut,className:N(["pdp-carousel__controls",[`pdp-carousel__controls--${n}`,d]]),children:(l?f.slice(0,g):f).map((t,r)=>{const s=l?g:f.length,o=l?u-1===r:u===r;return d?F("label",{className:N(["pdp-carousel__thumbnail__container"]),ref:a=>{a&&(e.current[r]=a)},children:[C("input",{type:"radio",name:"carousel-thumbnails","aria-label":nt.replace("{key}",String(r+1)).replace("{total}",String(s)),checked:o&&y!==0,onChange:()=>{v(l?r+1:r,!0)},...V,className:N(["pdp-carousel__thumbnail",["pdp-carousel__thumbnail--selected",o&&y!==0]])}),C("span",{className:N(["pdp-carousel__thumbnail__span"]),children:I[r]})]},r):C("button",{"aria-label":nt.replace("{key}",String(r+1)).replace("{total}",String(s)),onClick:()=>{v(l?r+1:r,!0)},className:N(["pdp-carousel__controls__button",["pdp-carousel__controls__button--active",o]])},r)})})}),(d||P)&&!$&&_t]})]})};function Lt(c,m=0){if(typeof c=="number")return c;const{small:_,medium:i,large:n}=c,l=[{breakpoint:1024,value:n},{breakpoint:786,value:i},{breakpoint:0,value:_}].find(({breakpoint:b})=>m>b);return l?l.value:_}function k(){return document.documentElement.dir==="rtl"}const Ot=({centered:c,onClose:m,className:_,children:i,...n})=>{const $=A("PDP.Overlay.Close.label").label,l=K(null),b=rt(()=>{m==null||m()},[m]);return R(()=>{const M=W=>{W.key==="Escape"&&b()};return document.addEventListener("keydown",M),()=>{document.removeEventListener("keydown",M)}},[b]),R(()=>{const M=l.current;M==null||M.focus();const W=document.scrollingElement,J=W.style.overflow;return W.style.overflow="hidden",()=>{W.style.overflow=J}},[]),F("div",{...n,className:N(["pdp-overlay",["pdp-overlay--centered",c],_]),ref:l,role:"dialog","aria-describedby":"overlay-content",tabindex:0,children:[C("div",{className:"pdp-overlay__content",id:"overlay-content",children:i}),C(mt,{"aria-label":$,variant:"tertiary",className:"pdp-overlay__close-button",onClick:b,icon:C(Ct,{})})]})},Zt=({children:c,scale:m=2,closeButton:_=!0})=>{const[i,n]=X(!1),[$,l]=X("pdp-zoom"),[b,M]=X(!1),[W,J]=X({x:0,y:0}),[Y,ct]=X({x:0,y:0}),[E,Q]=X({x:0,y:0}),P=K(null),V=K(!1),z=K(null),at=e=>{!i||e.type!=="touchstart"||(J({x:e.touches[0].clientX,y:e.touches[0].clientY}),ct({x:E.x,y:E.y}),M(!0))},it=e=>{var d;if(!b||e.type!=="touchmove")return;const y=(d=e.currentTarget)==null?void 0:d.getBoundingClientRect(),x=(100-100/m)/2,w=e.touches[0].clientX-W.x,O=e.touches[0].clientY-W.y,I=w*100/(y.width*m),f=O*100/(y.height*m),S=Y.x+I,Z=Y.y+f;Q({x:Math.max(-x,Math.min(S,x))||0,y:Math.max(-x,Math.min(Z,x))||0}),e.preventDefault()},B=e=>{var Z;const y=(Z=e.currentTarget)==null?void 0:Z.getBoundingClientRect(),x=(100-100/m)/2;let w=null;if("touches"in e)if(e.touches.length>0)w=e.touches[0],z.current={clientX:w.clientX,clientY:w.clientY};else if(e.type==="touchend"&&P.current)w={clientX:P.current.x,clientY:P.current.y};else if(z.current)w=z.current;else return;else if(e instanceof MouseEvent)w=e;else return;const O=(w.clientX-y.left)/y.width*100,I=(w.clientY-y.top)/y.height*100,f=(50-O)*(m-1)/m,S=(50-I)*(m-1)/m;Q({x:Math.max(-x,Math.min(f,x))||0,y:Math.max(-x,Math.min(S,x))||0})},ut=e=>{if(_)P.current={x:e.touches[0].clientX,y:e.touches[0].clientY,time:Date.now()},z.current={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},V.current=!1,i&&at(e);else{if(b)return;!i&&B(e),n(!i),e.preventDefault()}},nt=e=>{if(e.touches.length!==0){if(z.current={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},_){if(!P.current)return;if(b){it(e);return}const y=e.touches[0].clientX,x=e.touches[0].clientY,w=Math.abs(y-P.current.x),O=Math.abs(x-P.current.y);(w>10||O>10)&&(V.current=!0)}i&&B(e)}},h=e=>{if(_){if(!P.current)return;const y=Date.now()-P.current.time;!V.current&&y<300&&!b&&(n(!0),B(e),e.preventDefault()),M(!1),P.current=null}else n(!1)},ht=e=>{"touches"in e||b||(i?!_&&n(!1):(n(!0),B(e)),e.preventDefault())},g=e=>{"touches"in e||i&&B(e)},L=e=>{if(!("touches"in e)){if(_){M(!1);return}n(!1)}},q=e=>{n(!1),e.stopPropagation()},H=i?`scale(${m}) translateX(${E.x}%) translateY(${E.y}%)`:"none",u=A("PDP.Zoom.Close.label").label,ft=Et(j.only(c),{draggable:!1,style:{"--transform":H}});return R(()=>{l(i?`pdp-zoom ${_?"pdp-zoom--no-effects":"pdp-zoom--zoomed"}`:"pdp-zoom")},[i,_]),F("figure",{className:$,onClick:ht,onMouseMove:g,onMouseLeave:L,onTouchStart:ut,onTouchMove:nt,onTouchEnd:h,children:[ft,_&&i&&C(mt,{"aria-label":u,variant:"tertiary",className:"pdp-zoom__close-button",icon:C(Ct,{}),onClick:q})]})};export{Ht as C,Ot as O,Zt as Z};
