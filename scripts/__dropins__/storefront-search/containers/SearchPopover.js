/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as f,jsxs as L,Fragment as X}from"@dropins/tools/preact-jsx-runtime.js";import{useContext as Z,useRef as v,useEffect as x,useMemo as W,useState as F,useReducer as Q,createContext as G}from"@dropins/tools/preact-compat.js";import{g as J,c as _}from"../chunks/currency-symbol-map.js";import{s as Y}from"../chunks/searchProducts.js";import{v as ee}from"../chunks/tokens.js";import"@dropins/tools/preact-hooks.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";const N={SEARCH_INPUT_CONTEXT:"searchInputContext",SEARCH_RESULTS_CONTEXT:"searchResultsContext"},T={SEARCH_PRODUCT_CLICK:"search-product-click",SEARCH_SUGGESTION_CLICK:"search-suggestion-click",SEARCH_REQUEST_SENT:"search-request-sent",SEARCH_RESPONSE_RECEIVED:"search-response-received",SEARCH_RESULTS_VIEW:"search-results-view"},P=()=>(window.adobeDataLayer=window.adobeDataLayer||[],window.adobeDataLayer);function $(e,t){P().push({[e]:t})}function y(e,t){P().push(r=>{var o;const c=((o=r.getState)==null?void 0:o.call(r))??{};r.push({event:e,eventInfo:{...c,...t}})})}const E="livesearch-popover-dropin",te=()=>({publishSearchProductClick:o=>{y(T.SEARCH_PRODUCT_CLICK,{searchUnitId:E,sku:o})},updateSearchInputContext:()=>{},searchRequestSent:()=>{},searchResponseReceived:()=>{},searchResultsView:()=>{}});function K(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var c=e.length;for(t=0;t<c;t++)e[t]&&(n=K(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function M(){for(var e,t,n=0,r="",c=arguments.length;n<c;n++)(e=arguments[n])&&(t=K(e))&&(r&&(r+=" "),r+=t);return r}function ne(){return f("svg",{width:"60",height:"74",viewBox:"0 0 60 74",children:f("path",{d:"M26,85H70a8.009,8.009,0,0,0,8-8V29.941a7.947,7.947,0,0,0-2.343-5.657L64.716,13.343A7.946,7.946,0,0,0,59.059,11H26a8.009,8.009,0,0,0-8,8V77a8.009,8.009,0,0,0,8,8ZM20,19a6.007,6.007,0,0,1,6-6H59.059A5.96,5.96,0,0,1,63.3,14.757L74.242,25.7A5.96,5.96,0,0,1,76,29.941V77a6.007,6.007,0,0,1-6,6H26a6.007,6.007,0,0,1-6-6Zm6.614,51.06h0L68,69.98a.75.75,0,0,0,.545-1.263L57.67,57.129a1.99,1.99,0,0,0-2.808-.028L51.6,60.467l-.024.026-7.087-7.543a1.73,1.73,0,0,0-1.229-.535,1.765,1.765,0,0,0-1.249.5L26.084,68.778a.75.75,0,0,0,.529,1.281Zm26.061-8.548,3.252-3.354a.333.333,0,0,1,.332-.123.463.463,0,0,1,.324.126L66.27,68.484l-7.177.014-6.5-6.916a.735.735,0,0,0,.078-.071Zm-9.611-7.526a.235.235,0,0,1,.168-.069.212.212,0,0,1,.168.068L57.039,68.5l-28.606.055Zm20.05-.43h.079a5.087,5.087,0,0,0,3.583-1.47,5.146,5.146,0,1,0-7.279-.109,5.089,5.089,0,0,0,3.617,1.579Zm-2.456-7.839a3.6,3.6,0,0,1,2.534-1.042h.056a3.7,3.7,0,0,1,2.478,6.34,3.51,3.51,0,0,1-2.589,1.041,3.6,3.6,0,0,1-2.557-1.118,3.715,3.715,0,0,1,.079-5.221Z",transform:"translate(-18 -11)",fill:"#8e8e8e"})})}const w=()=>{const e=Z(q);if(e===null){const t=new Error("Missing <PopoverProvider /> component.");throw Error.captureStackTrace&&Error.captureStackTrace(t,w),t}return e};function re({className:e,...t}){const{products:n}=w();return n.length===0?null:L("button",{...t,type:"submit",className:M("search-popover-view-all",e),children:["View All (",n.length,")"]})}function ce(){const{products:e,route:t}=w(),{publishSearchProductClick:n}=te(),r=(c,o)=>{c.preventDefault();const s=c.currentTarget;n(o.sku),y(T.SEARCH_PRODUCT_CLICK),window.location.href=s.href};return f("div",{className:M("search-popover-root"),children:e.length>0&&L(X,{children:[f("div",{className:"search-popover-content",children:e.map(c=>L("div",{className:"search-popover-item",children:[f("div",{className:"popover-image-container",children:f(oe,{product:c})}),f("div",{className:"popover-details-container",children:L("a",{href:t==null?void 0:t({sku:c.sku,urlKey:c.urlKey??""}),onClick:o=>r(o,c),className:"product-link",children:[f("p",{className:"product-name",children:c.name}),f("p",{className:"product-price",children:c.price})]})})]},c.uid))}),f(re,{})]})})}function oe({product:e}){return e.imageUrl?f("img",{alt:"",src:e.imageUrl,className:"product-image"}):f(ne,{})}var se="Expected a function",H=NaN,ae="[object Symbol]",ie=/^\s+|\s+$/g,ue=/^[-+]0x[0-9a-f]+$/i,le=/^0b[01]+$/i,fe=/^0o[0-7]+$/i,de=parseInt,pe=typeof _=="object"&&_&&_.Object===Object&&_,he=typeof self=="object"&&self&&self.Object===Object&&self,me=pe||he||Function("return this")(),Se=Object.prototype,ge=Se.toString,Ee=Math.max,ve=Math.min,O=function(){return me.Date.now()};function Ce(e,t,n){var r,c,o,s,a,i,d=0,p=!1,S=!1,C=!0;if(typeof e!="function")throw new TypeError(se);t=j(t)||0,k(n)&&(p=!!n.leading,S="maxWait"in n,o=S?Ee(j(n.maxWait)||0,t):o,C="trailing"in n?!!n.trailing:C);function b(u){var m=r,I=c;return r=c=void 0,d=u,s=e.apply(I,m),s}function R(u){return d=u,a=setTimeout(g,t),p?b(u):s}function h(u){var m=u-i,I=u-d,D=t-m;return S?ve(D,o-I):D}function l(u){var m=u-i,I=u-d;return i===void 0||m>=t||m<0||S&&I>=o}function g(){var u=O();if(l(u))return U(u);a=setTimeout(g,h(u))}function U(u){return a=void 0,C&&r?b(u):(r=c=void 0,s)}function z(){a!==void 0&&clearTimeout(a),d=0,r=i=c=a=void 0}function B(){return a===void 0?s:U(O())}function A(){var u=O(),m=l(u);if(r=arguments,c=this,i=u,m){if(a===void 0)return R(i);if(S)return a=setTimeout(g,t),b(i)}return a===void 0&&(a=setTimeout(g,t)),s}return A.cancel=z,A.flush=B,A}function k(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function be(e){return!!e&&typeof e=="object"}function Re(e){return typeof e=="symbol"||be(e)&&ge.call(e)==ae}function j(e){if(typeof e=="number")return e;if(Re(e))return H;if(k(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=k(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(ie,"");var n=le.test(e);return n||fe.test(e)?de(e.slice(2),n?2:8):ue.test(e)?H:+e}var Ie=Ce;const V=J(Ie);function Te(e){const t=v(e);t.current=e,x(()=>()=>{t.current()},[])}function ye(e,t=500,n){const r=v();Te(()=>{r.current&&r.current.cancel()});const c=W(()=>{const o=V(e,t,n),s=(...a)=>o(...a);return s.cancel=()=>{o.cancel()},s.isPending=()=>!!r.current,s.flush=()=>o.flush(),s},[e,t,n]);return x(()=>{r.current=V(e,t,n)},[e,t,n]),c}function _e(e,t,n){const r=(d,p)=>d===p,c=e instanceof Function?e():e,[o,s]=F(c),a=v(c),i=ye(s,t,n);return r(a.current,c)||(i(c),a.current=c),[o,i]}const Le=(e,t,n,r,c)=>{var d;const s=P().getState(N.SEARCH_INPUT_CONTEXT)??{units:[]},a={searchUnitId:e,searchRequestId:t,queryTypes:["products","suggestions"],phrase:n,pageSize:c,currentPage:1,filter:r,sort:[]},i=(d=s.units)==null?void 0:d.findIndex(p=>(p==null?void 0:p.searchUnitId)===e);i===void 0||i<0?s.units.push(a):s.units[i]=a,$(N.SEARCH_INPUT_CONTEXT,s)},xe=(e,t,n)=>{var a;const c=P().getState(N.SEARCH_RESULTS_CONTEXT)??{units:[]},o=(a=c==null?void 0:c.units)==null?void 0:a.findIndex(i=>(i==null?void 0:i.searchUnitId)===e),s={searchUnitId:e,searchRequestId:t,products:(n==null?void 0:n.products.map(i=>({...i,price:Number(i.price)})))??[],categories:[],suggestions:[],page:(n==null?void 0:n.pageInfo.current)||1,perPage:(n==null?void 0:n.pageInfo.size)||6,facets:[]};o===void 0||o<0?c.units.push(s):c.units[o]=s,$(N.SEARCH_RESULTS_CONTEXT,c)},Ne={filters:[{attribute:"visibility",in:["Search","Catalog, Search"]},{attribute:"inStock",eq:"false"}],sort:[]};function Pe(e,t){switch(t.type){case"SET_IN_STOCK_FILTER":{const n=e.filters.map(r=>r.attribute==="inStock"?{...r,eq:String(t.value)}:r);return{...e,filters:n}}default:throw new Error(`Unknown action: ${t.type}`)}}const Ae=e=>{const[t,n]=Q(Pe,Ne);return{search:async o=>{const s=ee();Le(E,s,o,t.filters,e.pageSize),y(T.SEARCH_REQUEST_SENT,{searchUnitId:E});const a=await Y(o,e.pageSize);return xe(E,s,a),y(T.SEARCH_RESPONSE_RECEIVED,{searchUnitId:E}),y(T.SEARCH_RESULTS_VIEW,{searchUnitId:E}),a},setInStockFilter:o=>{n({type:"SET_IN_STOCK_FILTER",value:o})},filters:t.filters,sort:t.sort}},Oe={products:[],config:{pageSize:8,perPageConfig:{pageSizeOptions:[12,24,36],defaultPageSizeOption:24},minQueryLength:2,currencySymbol:"$",currencyRate:1,displayOutOfStock:!0,allowAllProducts:!1},route:({sku:e,urlKey:t})=>`/products/${t}/${e}`},q=G(Oe),Ke=({children:e,storefrontDetails:t})=>{const{config:r,route:c}=t,{search:o}=Ae(r),[s,a]=_e("",500),[i,d]=F([]),p=v(null),S=v(null),C=v(null),b={products:i,config:r,route:c},R=h=>{const l=h.currentTarget.value||"";a(l)};return x(()=>{const h=document.getElementById("search_mini_form"),l=document.getElementById("search"),g=document.getElementById("search_autocomplete");return p.current=h,S.current=l,C.current=g,l==null||l.addEventListener("input",R),l==null||l.addEventListener("input",R),()=>{l==null||l.removeEventListener("input",R)}},[]),x(()=>{(async()=>{if(s.length>+r.minQueryLength){const h=await o(s);d((h==null?void 0:h.products)??[])}})()},[s,r.minQueryLength,r.pageSize]),f(q.Provider,{value:b,children:f(ce,{})})};export{q as PopoverContext,Ke as SearchPopover,Ke as default,w as usePopover};
